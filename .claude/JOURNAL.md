# Claude Code Journal

This journal tracks substantive work on documents, diagrams, and documentation content.

---

1. **Task - Project initialization** (v0.1.0): Initialized jupyterlab_kernel_terminal_workspace_culler_extension as a new JupyterLab extension project with Claude Code configuration<br>
    **Result**: Created `.claude/CLAUDE.md` with workspace import directive linking to `/home/lab/workspace/.claude/CLAUDE.md`, reinforcing mandatory bans for git operations and package management. Created `.claude/JOURNAL.md` for tracking substantive work. Updated README.md with standardized badges (GitHub Actions, npm, PyPI, downloads, JupyterLab 4, KOLOMOLO, PayPal) and concise feature list. Extension provides automatic culling of idle kernels, terminals, and workspaces with configurable timeout settings. Project uses TypeScript frontend with Python server extension targeting JupyterLab 4.x.

2. **Task - Culler implementation** (v0.1.1): Implemented server-side resource culler with frontend settings sync and notification support<br>
    **Result**: Created `culler.py` with `ResourceCuller` class using tornado's `PeriodicCallback` for scheduled culling of idle kernels, terminals, and sessions. Implemented `_cull_kernels()` checking execution_state and last_activity, `_cull_terminals()` parsing datetime from terminal manager list, and `_cull_sessions()` checking associated kernel activity. All culling logged at INFO level with `[Culler]` prefix. Updated `routes.py` with three handlers: `SettingsHandler` (POST `/settings`) for frontend settings sync with camelCase to snake_case conversion, `StatusHandler` (GET `/status`) returning running state and current settings, `CullResultHandler` (GET `/cull-result`) returning consumed-once culling results for notification polling. Updated `__init__.py` to instantiate `ResourceCuller` with server_app reference and call `start()` on extension load. Updated `schema/plugin.json` with 8 configurable settings: kernelCullEnabled (default true), kernelCullIdleTimeout (60 min), terminalCullEnabled (true), terminalCullIdleTimeout (30 min), sessionCullEnabled (false), sessionCullIdleTimeout (120 min), cullCheckInterval (5 min), showNotifications (true). Updated `src/index.ts` with `syncSettings()` posting composite settings on load and change, and `pollCullResults()` polling `/cull-result` every 30 seconds - if resources were culled and showNotifications enabled, displays notification via jupyterlab-notifications-extension command or falls back to console.info. Created `tests/test_culler.py` with pytest-asyncio tests covering default settings verification, settings update with camelCase mapping, idle kernel culling with execution_state and last_activity checks, busy kernel skipping, active kernel skipping, idle terminal culling, terminal with ISO string timestamps, and cull result consumption tracking. Build successful at v0.1.1, all frontend tests pass.

3. **Task - Bugfixes and CI/CD** (v0.1.8): Fixed terminal manager access, notification formatting, updated defaults, added documentation and CI/CD workflows<br>
    **Result**: Fixed terminal culling failure in JupyterHub environments where `terminal_manager` is not directly on server_app - added fallback to `web_app.settings.get("terminal_manager")` in `culler.py`. Fixed notification display showing literal `<br>` tags by changing to `\n` newlines in `src/index.ts`. Added `skipLibCheck: true` to `tsconfig.json` to resolve lib0 TypeScript declaration errors with newer TS versions. Updated default timeouts: kernel 60min (1h), terminal 60min (1h), session 10080min (7d). Comprehensive README update with Default Settings table, How Idle Detection Works section explaining kernel/terminal/session activity tracking, and FAQ section covering long-running calculations (recommending `screen`/`tmux` or increasing timeouts), browser tab behavior, `nohup` process survival, disabling culling, and viewing cull logs. Created `.github/workflows/` with five CI/CD workflows following JUPYTERLAB_EXTENSION.md guidelines: `build.yml` for build/test/package on push/PR with link checking, `check-release.yml` for release readiness verification, `prep-release.yml` for manual release preparation, `publish-release.yml` for npm/PyPI publishing, and `enforce-label.yml` for PR label enforcement. All workflows configured with `steps_to_skip: "build-changelog"` and `RH_SINCE_LAST_STABLE: 'true'` for direct commit workflow compatibility.
